from datetime import datetime
from typing import List

from pptx.enum.shapes import MSO_SHAPE_TYPE
from pptx.slide import Slide, SlideLayout

from potion import ComposeSchema, DesignSchema, Potion

# creating NCSgpt Potion from slide template


async def create_title_slide(ds: DesignSchema, slide: Slide) -> None:
    """Create the title slide with a title and current date."""
    print("Creating Title Slide")
    presentation_title = ds.slide_title
    current_date = datetime.now().strftime("%B %d, %Y")

    for shape in slide.shapes:
        # Check if the shape is a placeholder for the title
        if shape.shape_type == MSO_SHAPE_TYPE.PLACEHOLDER:
            if shape.placeholder_format.idx == 0:  # Usually 0 is the title placeholder
                shape.text = presentation_title
        # Check if the shape is a placeholder for the date or a text box
        elif shape.shape_type == MSO_SHAPE_TYPE.TEXT_BOX:
            text_frame = shape.text_frame
            text_frame.clear()
            text_frame.text = f"{current_date} - generated by Copilot"


async def create_text_slide(ds: DesignSchema, slide: Slide) -> None:
    """Create a text slide with a title and description."""
    print("Creating Text Concentrated Slide")
    for shape in slide.placeholders:
        if shape.placeholder_format.idx == 0:
            shape.text = ds.slide_title
        elif shape.placeholder_format.idx in [1, 2]:
            shape.text = ds.desc
            break


async def create_end_slide(ds: DesignSchema, slide: SlideLayout) -> None:
    """Creating the end slide"""
    print("Creating ending slide :)")
    pass


compose_schemas: List[ComposeSchema] = [
    ComposeSchema(
        name="title_slide",
        desc="Use this slide when it's the start of a presentation.",
        func=create_title_slide,
        slide_layout_index=0,
    ),
    ComposeSchema(
        name="text_slide",
        desc="Use this slide when you want to present a text-concentrated slide.",
        func=create_text_slide,
        slide_layout_index=1,
    ),
    ComposeSchema(
        name="end_slide",
        desc="Use this slide when it's the end of a presentation.",
        func=create_end_slide,
        slide_layout_index=2,
    ),
]

ncspotion = Potion(
    template_path="templates/nila_ppt_template.pptx", compose_schemas=compose_schemas
)
